{"ast":null,"code":"var patientIcon=\"https://img.icons8.com/ios/50/000000/consultation.png\";var doctorIcon=\"https://img.icons8.com/wired/64/000000/medical-doctor.png\";export var getMessages=function getMessages(chatPage,isDoctor){var url=isDoctor?\"/doctors/check-session\":\"/patients/check-session\";fetch(url).then(function(res){if(res.status===200){return res.json();}}).then(function(json){if(json&&(json.currentPatient||json.currentDoctor)){if(!isDoctor){chatPage.setState({currentPatient:json.currentPatient});}else{chatPage.setState({currentDoctor:json.currentDoctor});}}var url1=isDoctor?\"/patients/contact-session\":\"/doctors/contact-session\";fetch(url1).then(function(res){if(res.status===200){return res.json();}}).then(function(json){if(json&&(json.selectedDoctor||json.selectedPatient)){if(!isDoctor){chatPage.setState({selectedDoctor:json.selectedDoctor});}else{chatPage.setState({selectedPatient:json.selectedPatient});}}var p=isDoctor?chatPage.state.selectedPatient.username:chatPage.state.currentPatient.username;var d=isDoctor?chatPage.state.currentDoctor.username:chatPage.state.selectedDoctor.username;var url2=\"/messages/\".concat(p,\"/\").concat(d);fetch(url2).then(function(res){if(res.status===200){return res.json();}}).then(function(json){var messages=[];for(var i=0;i<json.length;i++){messages.push({\"text\":json[i].text,\"id\":(i+1).toString(),\"sender\":{\"name\":json[i].sender,\"uid\":json[i].sender===p?\"2\":\"1\",\"avatar\":json[i].sender===p?patientIcon:doctorIcon}});}chatPage.setState({messages:messages});}).catch(function(error){console.log(error);});}).catch(function(error){console.log(error);});}).catch(function(error){console.log(error);});};export var setPatientChatPage=function setPatientChatPage(doctor,app,history){var url1=\"/doctors/\".concat(doctor);fetch(url1).then(function(res){if(res.status===200){return res.json();}}).then(function(json){app.setState({selectedDoctor:json[0]});var url=\"/patients\";var data={patient:app.state.currentPatient,doctor:json[0]};var request=new Request(url,{method:\"put\",body:JSON.stringify(data),headers:{Accept:\"application/json, text/plain, */*\",\"Content-Type\":\"application/json\"}});fetch(request).then(function(res){history.push(\"/ChatPage/PatientChatPage\");}).catch(function(error){console.log(error);});}).catch(function(error){console.log(error);});};export var getPatientMessage=function getPatientMessage(pdc){var url=\"/doctors/check-session\";fetch(url).then(function(res){if(res.status===200){return res.json();}}).then(function(json){if(json&&json.currentDoctor){pdc.setState({currentDoctor:json.currentDoctor});}var url1=\"/messages/\".concat(pdc.state.currentDoctor.username);fetch(url1).then(function(res){if(res.status===200){return res.json();}}).then(function(json){var patientMessages=[];var _loop=function _loop(){var message=json.pop();json=json.filter(function(m){return m.sender!==message.sender;});patientMessages.push(message);};while(json.length>0){_loop();}pdc.setState({patientMessages:patientMessages});}).catch(function(error){console.log(error);});}).catch(function(error){console.log(error);});};export var setDoctorChatPage=function setDoctorChatPage(patient,app,history){var url=\"/patients/\".concat(patient);fetch(url).then(function(res){if(res.status===200){return res.json();}}).then(function(json){app.setState({selectedPatient:json[0]});history.push(\"/ChatPage/DoctorChatPage\");}).catch(function(error){console.log(error);});};var messageReplied=function messageReplied(receiver,sender){var request=new Request(\"/messages/replied\",{method:\"post\",body:JSON.stringify({sender:sender,receiver:receiver}),headers:{Accept:\"application/json, text/plain, */*\",\"Content-Type\":\"application/json\"}});fetch(request).catch(function(error){console.log(error);});};export var sendMessage=function sendMessage(message,cp){var sender=cp.state.isDoctor?cp.state.currentDoctor.username:cp.state.currentPatient.username;var receiver=cp.state.isDoctor?cp.state.selectedPatient.username:cp.state.selectedDoctor.username;messageReplied(sender,receiver);var data={sender:sender,receiver:receiver,text:message,isReplied:false};var request=new Request(\"/messages\",{method:\"post\",body:JSON.stringify(data),headers:{Accept:\"application/json, text/plain, */*\",\"Content-Type\":\"application/json\"}});fetch(request).catch(function(error){console.log(error);});};export var displayMessage=function displayMessage(message,chatPage){var avatar=chatPage.state.isDoctor?doctorIcon:patientIcon;var newMessage={\"text\":message,\"id\":chatPage.state.messages.length+1,\"sender\":{\"name\":chatPage.state.name,\"uid\":chatPage.state.user.uid,\"avatar\":avatar}};chatPage.state.messages.push(newMessage);};","map":{"version":3,"sources":["/Users/yehuang/309_group/client/src/actions/message.js"],"names":["patientIcon","doctorIcon","getMessages","chatPage","isDoctor","url","fetch","then","res","status","json","currentPatient","currentDoctor","setState","url1","selectedDoctor","selectedPatient","p","state","username","d","url2","messages","i","length","push","text","toString","sender","catch","error","console","log","setPatientChatPage","doctor","app","history","data","patient","request","Request","method","body","JSON","stringify","headers","Accept","getPatientMessage","pdc","patientMessages","message","pop","filter","m","setDoctorChatPage","messageReplied","receiver","sendMessage","cp","isReplied","displayMessage","avatar","newMessage","name","user","uid"],"mappings":"AAAA,GAAMA,CAAAA,WAAW,CAAG,uDAApB,CACA,GAAMC,CAAAA,UAAU,CAAG,2DAAnB,CAEA,MAAO,IAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,QAAD,CAAWC,QAAX,CAAwB,CAC/C,GAAMC,CAAAA,GAAG,CAAGD,QAAQ,CAAG,wBAAH,CAA8B,yBAAlD,CACAE,KAAK,CAACD,GAAD,CAAL,CACKE,IADL,CACU,SAACC,GAAD,CAAS,CACX,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CALL,EAMKH,IANL,CAMU,SAACG,IAAD,CAAU,CACZ,GAAIA,IAAI,GAAKA,IAAI,CAACC,cAAL,EAAuBD,IAAI,CAACE,aAAjC,CAAR,CAAyD,CACrD,GAAI,CAACR,QAAL,CAAe,CACXD,QAAQ,CAACU,QAAT,CAAkB,CAACF,cAAc,CAAED,IAAI,CAACC,cAAtB,CAAlB,EACH,CAFD,IAEO,CACHR,QAAQ,CAACU,QAAT,CAAkB,CAACD,aAAa,CAAEF,IAAI,CAACE,aAArB,CAAlB,EACH,CACJ,CACD,GAAME,CAAAA,IAAI,CAAGV,QAAQ,CAAG,2BAAH,CAAiC,0BAAtD,CACAE,KAAK,CAACQ,IAAD,CAAL,CACKP,IADL,CACU,SAACC,GAAD,CAAS,CACX,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CALL,EAMKH,IANL,CAMU,SAACG,IAAD,CAAU,CACZ,GAAIA,IAAI,GAAKA,IAAI,CAACK,cAAL,EAAuBL,IAAI,CAACM,eAAjC,CAAR,CAA2D,CACvD,GAAI,CAACZ,QAAL,CAAe,CACXD,QAAQ,CAACU,QAAT,CAAkB,CAACE,cAAc,CAAEL,IAAI,CAACK,cAAtB,CAAlB,EACH,CAFD,IAEO,CACHZ,QAAQ,CAACU,QAAT,CAAkB,CAACG,eAAe,CAAEN,IAAI,CAACM,eAAvB,CAAlB,EACH,CACJ,CACD,GAAMC,CAAAA,CAAC,CAAGb,QAAQ,CAAGD,QAAQ,CAACe,KAAT,CAAeF,eAAf,CAA+BG,QAAlC,CAA6ChB,QAAQ,CAACe,KAAT,CAAeP,cAAf,CAA8BQ,QAA7F,CACA,GAAMC,CAAAA,CAAC,CAAGhB,QAAQ,CAAGD,QAAQ,CAACe,KAAT,CAAeN,aAAf,CAA6BO,QAAhC,CAA2ChB,QAAQ,CAACe,KAAT,CAAeH,cAAf,CAA8BI,QAA3F,CACA,GAAME,CAAAA,IAAI,qBAAgBJ,CAAhB,aAAqBG,CAArB,CAAV,CACAd,KAAK,CAACe,IAAD,CAAL,CACKd,IADL,CACU,SAACC,GAAD,CAAS,CACX,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CALL,EAMKH,IANL,CAMU,SAACG,IAAD,CAAU,CACZ,GAAMY,CAAAA,QAAQ,CAAG,EAAjB,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGb,IAAI,CAACc,MAAzB,CAAiCD,CAAC,EAAlC,CAAsC,CAClCD,QAAQ,CAACG,IAAT,CAAc,CACV,OAAQf,IAAI,CAACa,CAAD,CAAJ,CAAQG,IADN,CAEV,KAAM,CAACH,CAAC,CAAG,CAAL,EAAQI,QAAR,EAFI,CAGV,SAAU,CACN,OAAQjB,IAAI,CAACa,CAAD,CAAJ,CAAQK,MADV,CAEN,MAAOlB,IAAI,CAACa,CAAD,CAAJ,CAAQK,MAAR,GAAmBX,CAAnB,CAAuB,GAAvB,CAA6B,GAF9B,CAGN,SAAUP,IAAI,CAACa,CAAD,CAAJ,CAAQK,MAAR,GAAmBX,CAAnB,CAAuBjB,WAAvB,CAAqCC,UAHzC,CAHA,CAAd,EASH,CACDE,QAAQ,CAACU,QAAT,CAAkB,CACdS,QAAQ,CAAEA,QADI,CAAlB,EAGH,CAtBL,EAuBKO,KAvBL,CAuBW,SAACC,KAAD,CAAW,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAzBL,EA0BH,CA3CL,EA4CKD,KA5CL,CA4CW,SAACC,KAAD,CAAW,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CA9CL,EA+CH,CA9DL,EA+DKD,KA/DL,CA+DW,SAACC,KAAD,CAAW,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAjEL,EAkEH,CApEM,CAsEP,MAAO,IAAMG,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,MAAD,CAASC,GAAT,CAAcC,OAAd,CAA0B,CACxD,GAAMtB,CAAAA,IAAI,oBAAeoB,MAAf,CAAV,CACA5B,KAAK,CAACQ,IAAD,CAAL,CAAYP,IAAZ,CAAiB,SAACC,GAAD,CAAS,CACtB,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CAJD,EAIGH,IAJH,CAIQ,SAACG,IAAD,CAAU,CACdyB,GAAG,CAACtB,QAAJ,CAAa,CACTE,cAAc,CAAEL,IAAI,CAAC,CAAD,CADX,CAAb,EAGA,GAAML,CAAAA,GAAG,CAAG,WAAZ,CACA,GAAMgC,CAAAA,IAAI,CAAG,CACTC,OAAO,CAAEH,GAAG,CAACjB,KAAJ,CAAUP,cADV,CAETuB,MAAM,CAAExB,IAAI,CAAC,CAAD,CAFH,CAAb,CAIA,GAAM6B,CAAAA,OAAO,CAAG,GAAIC,CAAAA,OAAJ,CAAYnC,GAAZ,CAAiB,CAC7BoC,MAAM,CAAE,KADqB,CAE7BC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAeP,IAAf,CAFuB,CAG7BQ,OAAO,CAAE,CACLC,MAAM,CAAE,mCADH,CAEL,eAAgB,kBAFX,CAHoB,CAAjB,CAAhB,CAQAxC,KAAK,CAACiC,OAAD,CAAL,CAAehC,IAAf,CAAoB,SAACC,GAAD,CAAS,CACzB4B,OAAO,CAACX,IAAR,CAAa,2BAAb,EACH,CAFD,EAEGI,KAFH,CAES,SAACC,KAAD,CAAW,CAChBC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAJD,EAKH,CA1BD,EA0BGD,KA1BH,CA0BS,SAACC,KAAD,CAAW,CAChBC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CA5BD,EA6BH,CA/BM,CAiCP,MAAO,IAAMiB,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,GAAD,CAAS,CACtC,GAAM3C,CAAAA,GAAG,CAAG,wBAAZ,CACAC,KAAK,CAACD,GAAD,CAAL,CACKE,IADL,CACU,SAACC,GAAD,CAAS,CACX,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CALL,EAMKH,IANL,CAMU,SAACG,IAAD,CAAU,CACZ,GAAIA,IAAI,EAAIA,IAAI,CAACE,aAAjB,CAAgC,CAC5BoC,GAAG,CAACnC,QAAJ,CAAa,CAACD,aAAa,CAAEF,IAAI,CAACE,aAArB,CAAb,EACH,CACD,GAAME,CAAAA,IAAI,qBAAgBkC,GAAG,CAAC9B,KAAJ,CAAUN,aAAV,CAAwBO,QAAxC,CAAV,CACAb,KAAK,CAACQ,IAAD,CAAL,CACKP,IADL,CACU,SAACC,GAAD,CAAS,CACX,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CALL,EAMKH,IANL,CAMU,SAACG,IAAD,CAAU,CACZ,GAAMuC,CAAAA,eAAe,CAAG,EAAxB,CADY,2BAGR,GAAIC,CAAAA,OAAO,CAAGxC,IAAI,CAACyC,GAAL,EAAd,CACAzC,IAAI,CAAGA,IAAI,CAAC0C,MAAL,CAAY,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACzB,MAAF,GAAasB,OAAO,CAACtB,MAAzB,EAAb,CAAP,CACAqB,eAAe,CAACxB,IAAhB,CAAqByB,OAArB,EALQ,EAEZ,MAAOxC,IAAI,CAACc,MAAL,CAAc,CAArB,CAAwB,SAIvB,CACDwB,GAAG,CAACnC,QAAJ,CAAa,CACToC,eAAe,CAAEA,eADR,CAAb,EAGH,CAhBL,EAiBKpB,KAjBL,CAiBW,SAACC,KAAD,CAAW,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAnBL,EAoBH,CA/BL,EAgCKD,KAhCL,CAgCW,SAACC,KAAD,CAAW,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAlCL,EAmCH,CArCM,CAuCP,MAAO,IAAMwB,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAChB,OAAD,CAAUH,GAAV,CAAeC,OAAf,CAA2B,CACxD,GAAM/B,CAAAA,GAAG,qBAAgBiC,OAAhB,CAAT,CACAhC,KAAK,CAACD,GAAD,CAAL,CAAWE,IAAX,CAAgB,SAACC,GAAD,CAAS,CACrB,GAAIA,GAAG,CAACC,MAAJ,GAAe,GAAnB,CAAwB,CACpB,MAAOD,CAAAA,GAAG,CAACE,IAAJ,EAAP,CACH,CACJ,CAJD,EAIGH,IAJH,CAIQ,SAACG,IAAD,CAAU,CACdyB,GAAG,CAACtB,QAAJ,CAAa,CACTG,eAAe,CAAEN,IAAI,CAAC,CAAD,CADZ,CAAb,EAGA0B,OAAO,CAACX,IAAR,CAAa,0BAAb,EACH,CATD,EASGI,KATH,CASS,SAAAC,KAAK,CAAI,CACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAXD,EAYH,CAdM,CAgBP,GAAMyB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,QAAD,CAAW5B,MAAX,CAAsB,CACzC,GAAMW,CAAAA,OAAO,CAAG,GAAIC,CAAAA,OAAJ,CAAY,mBAAZ,CAAiC,CAC7CC,MAAM,CAAE,MADqC,CAE7CC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACjBhB,MAAM,CAAEA,MADS,CAEjB4B,QAAQ,CAAEA,QAFO,CAAf,CAFuC,CAM7CX,OAAO,CAAE,CACLC,MAAM,CAAE,mCADH,CAEL,eAAgB,kBAFX,CANoC,CAAjC,CAAhB,CAWAxC,KAAK,CAACiC,OAAD,CAAL,CAAeV,KAAf,CAAqB,SAAAC,KAAK,CAAI,CAC1BC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAFD,EAGH,CAfD,CAiBA,MAAO,IAAM2B,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACP,OAAD,CAAUQ,EAAV,CAAiB,CACxC,GAAM9B,CAAAA,MAAM,CAAG8B,EAAE,CAACxC,KAAH,CAASd,QAAT,CAAoBsD,EAAE,CAACxC,KAAH,CAASN,aAAT,CAAuBO,QAA3C,CAAsDuC,EAAE,CAACxC,KAAH,CAASP,cAAT,CAAwBQ,QAA7F,CACA,GAAMqC,CAAAA,QAAQ,CAAGE,EAAE,CAACxC,KAAH,CAASd,QAAT,CAAoBsD,EAAE,CAACxC,KAAH,CAASF,eAAT,CAAyBG,QAA7C,CAAwDuC,EAAE,CAACxC,KAAH,CAASH,cAAT,CAAwBI,QAAjG,CACAoC,cAAc,CAAC3B,MAAD,CAAS4B,QAAT,CAAd,CACA,GAAMnB,CAAAA,IAAI,CAAG,CACTT,MAAM,CAAEA,MADC,CAET4B,QAAQ,CAAEA,QAFD,CAGT9B,IAAI,CAAEwB,OAHG,CAITS,SAAS,CAAE,KAJF,CAAb,CAMA,GAAMpB,CAAAA,OAAO,CAAG,GAAIC,CAAAA,OAAJ,CAAY,WAAZ,CAAyB,CACrCC,MAAM,CAAE,MAD6B,CAErCC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAeP,IAAf,CAF+B,CAGrCQ,OAAO,CAAE,CACLC,MAAM,CAAE,mCADH,CAEL,eAAgB,kBAFX,CAH4B,CAAzB,CAAhB,CAQAxC,KAAK,CAACiC,OAAD,CAAL,CAAeV,KAAf,CAAqB,SAAAC,KAAK,CAAI,CAC1BC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACH,CAFD,EAGH,CArBM,CAwBP,MAAO,IAAM8B,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACV,OAAD,CAAU/C,QAAV,CAAuB,CACjD,GAAM0D,CAAAA,MAAM,CAAG1D,QAAQ,CAACe,KAAT,CAAed,QAAf,CAA0BH,UAA1B,CAAuCD,WAAtD,CACA,GAAM8D,CAAAA,UAAU,CAAG,CACf,OAAQZ,OADO,CAEf,KAAM/C,QAAQ,CAACe,KAAT,CAAeI,QAAf,CAAwBE,MAAxB,CAAiC,CAFxB,CAGf,SAAU,CACN,OAAQrB,QAAQ,CAACe,KAAT,CAAe6C,IADjB,CAEN,MAAO5D,QAAQ,CAACe,KAAT,CAAe8C,IAAf,CAAoBC,GAFrB,CAGN,SAAUJ,MAHJ,CAHK,CAAnB,CASA1D,QAAQ,CAACe,KAAT,CAAeI,QAAf,CAAwBG,IAAxB,CAA6BqC,UAA7B,EACH,CAZM","sourcesContent":["const patientIcon = \"https://img.icons8.com/ios/50/000000/consultation.png\";\nconst doctorIcon = \"https://img.icons8.com/wired/64/000000/medical-doctor.png\";\n\nexport const getMessages = (chatPage, isDoctor) => {\n    const url = isDoctor ? \"/doctors/check-session\" : \"/patients/check-session\";\n    fetch(url)\n        .then((res) => {\n            if (res.status === 200) {\n                return res.json();\n            }\n        })\n        .then((json) => {\n            if (json && (json.currentPatient || json.currentDoctor)) {\n                if (!isDoctor) {\n                    chatPage.setState({currentPatient: json.currentPatient})\n                } else {\n                    chatPage.setState({currentDoctor: json.currentDoctor})\n                }\n            }\n            const url1 = isDoctor ? \"/patients/contact-session\" : \"/doctors/contact-session\";\n            fetch(url1)\n                .then((res) => {\n                    if (res.status === 200) {\n                        return res.json();\n                    }\n                })\n                .then((json) => {\n                    if (json && (json.selectedDoctor || json.selectedPatient)) {\n                        if (!isDoctor) {\n                            chatPage.setState({selectedDoctor: json.selectedDoctor});\n                        } else {\n                            chatPage.setState({selectedPatient: json.selectedPatient})\n                        }\n                    }\n                    const p = isDoctor ? chatPage.state.selectedPatient.username : chatPage.state.currentPatient.username;\n                    const d = isDoctor ? chatPage.state.currentDoctor.username : chatPage.state.selectedDoctor.username;\n                    const url2 = `/messages/${p}/${d}`;\n                    fetch(url2)\n                        .then((res) => {\n                            if (res.status === 200) {\n                                return res.json();\n                            }\n                        })\n                        .then((json) => {\n                            const messages = [];\n                            for (let i = 0; i < json.length; i++) {\n                                messages.push({\n                                    \"text\": json[i].text,\n                                    \"id\": (i + 1).toString(),\n                                    \"sender\": {\n                                        \"name\": json[i].sender,\n                                        \"uid\": json[i].sender === p ? \"2\" : \"1\",\n                                        \"avatar\": json[i].sender === p ? patientIcon : doctorIcon\n                                    }\n                                })\n                            }\n                            chatPage.setState({\n                                messages: messages\n                            })\n                        })\n                        .catch((error) => {\n                            console.log(error);\n                        })\n                })\n                .catch((error) => {\n                    console.log(error);\n                });\n        })\n        .catch((error) => {\n            console.log(error);\n        })\n};\n\nexport const setPatientChatPage = (doctor, app, history) => {\n    const url1 = `/doctors/${doctor}`;\n    fetch(url1).then((res) => {\n        if (res.status === 200) {\n            return res.json()\n        }\n    }).then((json) => {\n        app.setState({\n            selectedDoctor: json[0]\n        });\n        const url = \"/patients\";\n        const data = {\n            patient: app.state.currentPatient,\n            doctor: json[0]\n        };\n        const request = new Request(url, {\n            method: \"put\",\n            body: JSON.stringify(data),\n            headers: {\n                Accept: \"application/json, text/plain, */*\",\n                \"Content-Type\": \"application/json\",\n            },\n        });\n        fetch(request).then((res) => {\n            history.push(\"/ChatPage/PatientChatPage\")\n        }).catch((error) => {\n            console.log(error)\n        });\n    }).catch((error) => {\n        console.log(error);\n    });\n};\n\nexport const getPatientMessage = (pdc) => {\n    const url = \"/doctors/check-session\";\n    fetch(url)\n        .then((res) => {\n            if (res.status === 200) {\n                return res.json();\n            }\n        })\n        .then((json) => {\n            if (json && json.currentDoctor) {\n                pdc.setState({currentDoctor: json.currentDoctor});\n            }\n            const url1 = `/messages/${pdc.state.currentDoctor.username}`;\n            fetch(url1)\n                .then((res) => {\n                    if (res.status === 200) {\n                        return res.json();\n                    }\n                })\n                .then((json) => {\n                    const patientMessages = [];\n                    while (json.length > 0) {\n                        let message = json.pop();\n                        json = json.filter(m => m.sender !== message.sender);\n                        patientMessages.push(message)\n                    }\n                    pdc.setState({\n                        patientMessages: patientMessages\n                    })\n                })\n                .catch((error) => {\n                    console.log(error);\n                });\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n};\n\nexport const setDoctorChatPage = (patient, app, history) => {\n    const url = `/patients/${patient}`;\n    fetch(url).then((res) => {\n        if (res.status === 200) {\n            return res.json()\n        }\n    }).then((json) => {\n        app.setState({\n            selectedPatient: json[0]\n        });\n        history.push(\"/ChatPage/DoctorChatPage\")\n    }).catch(error => {\n        console.log(error)\n    })\n};\n\nconst messageReplied = (receiver, sender) => {\n    const request = new Request(\"/messages/replied\", {\n        method: \"post\",\n        body: JSON.stringify({\n            sender: sender,\n            receiver: receiver\n        }),\n        headers: {\n            Accept: \"application/json, text/plain, */*\",\n            \"Content-Type\": \"application/json\",\n        },\n    });\n    fetch(request).catch(error => {\n        console.log(error)\n    })\n};\n\nexport const sendMessage = (message, cp) => {\n    const sender = cp.state.isDoctor ? cp.state.currentDoctor.username : cp.state.currentPatient.username;\n    const receiver = cp.state.isDoctor ? cp.state.selectedPatient.username : cp.state.selectedDoctor.username;\n    messageReplied(sender, receiver);\n    const data = {\n        sender: sender,\n        receiver: receiver,\n        text: message,\n        isReplied: false\n    };\n    const request = new Request(\"/messages\", {\n        method: \"post\",\n        body: JSON.stringify(data),\n        headers: {\n            Accept: \"application/json, text/plain, */*\",\n            \"Content-Type\": \"application/json\",\n        },\n    });\n    fetch(request).catch(error => {\n        console.log(error)\n    })\n};\n\n\nexport const displayMessage = (message, chatPage) => {\n    const avatar = chatPage.state.isDoctor ? doctorIcon : patientIcon;\n    const newMessage = {\n        \"text\": message,\n        \"id\": chatPage.state.messages.length + 1,\n        \"sender\": {\n            \"name\": chatPage.state.name,\n            \"uid\": chatPage.state.user.uid,\n            \"avatar\": avatar,\n        },\n    };\n    chatPage.state.messages.push(newMessage);\n};\n"]},"metadata":{},"sourceType":"module"}